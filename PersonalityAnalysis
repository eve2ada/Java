//Yi He
//10/20/2015
//CSE 143X
//TA:Rasika Bhalerao
//HW #4
//
//This program will reveal something interesting about the class data
import java.awt.*;
import java.io.*;
import java.util.*;

public class PersonalityAnalysis {
	public static final int DIMENSION = 4; //dimension of test
	public static final int SURVEYS = 70;//survey questions
	
	public static void main(String[] args) throws FileNotFoundException{		
		//generate result file
		generateResult();
			
		//survey result analysis
		//group people by gender, (intended) major, color, favorite activity, section
		File resultFile = new File("result.txt");
		Scanner typeResult = new Scanner(resultFile);
		
		File demoFile = new File("demographics.csv");
		Scanner demoResult = new Scanner(demoFile);
		
		//wrap all surveyors' information
		int counter_line = counterFileLines(typeResult);
//		typeResult = new Scanner(resultFile);
		surveyor[] info = wrap(typeResult,counter_line);
		
		//calculate statistics of survey result by groups
		PrintStream output = new PrintStream(new File("statistics.txt")); //output file
		output.println("Welcome to Personality Survey Statistics Report of CSE 143X-2015AU");
		output.println();

		//type distribution vs. gender
		int[] typeDistribution_F = countType(info, "F");
		int[] percent_F = countByGender(typeDistribution_F);
		
		int[] typeDistribution_M = countType(info, "M");
		int[] percent_M = countByGender(typeDistribution_M);
		//output to file
		output_gender(output, percent_F, percent_M);
		
		//most favorite color by CSE 143X
		
		//output to file
		output.println("**********************************************************");
		output.println("Favorite Color of CSE 143X-2015AU");
		output.println("**********************************************************");
				
	}
	
	//nested class for information of one surveyor
	public static class surveyor{
		String EI;
		String SN;
		String TF;
		String JP;
		String gender;
		String color;
		String major;
		String section;
	}
	//,ethod to count all lines in file
	public static int counterFileLines(Scanner typeResult){
		//count the surveyors
		int counter_line = 0;
		while(typeResult.hasNextLine()){
			String temp = typeResult.nextLine();
			counter_line ++;			
		}
		return counter_line;
	}
	//method to wrap all information into surveyor class
	public static surveyor[] wrap(Scanner typeResult, Scanner demoResult, int counter_line){
		//array for all info (as surveyor class)
		surveyor[] info = new surveyor[counter_line];
		for(int i = 0; i < counter_line; i++){
			String line = typeResult.nextLine();
			String line2 = demoResult.nextLine();
			
			info[i].EI = line.substring(0,1);
			info[i].SN = line.substring(1,2);
			info[i].TF = line.substring(2,3);
			info[i].JP = line.substring(3,4);
			info[i].gender = line.substring(4, 5);
			info[i].color = line.substring(5,6);
			info[i].major = line.substring(6,7);
			info[i].section = line.substring(7,9);				
		}
		
		return info;
	}
	
	//method to count all female/male surveyors and calculate percentages
	public static int[] countByGender(int[] typeDistribution){
		float[] percentage = new float[DIMENSION * 2];
		int[] percent = new int[DIMENSION*2];
		//count all female surveyors and calculate percentages
		int sum = 0;
		for(int i = 0; i < DIMENSION*2; i++){
			sum += typeDistribution[i];
		}
		for(int i = 0; i < DIMENSION*2; i++){
			percentage[i] = (float)typeDistribution[i]/sum;
			percent[i] = (int) Math.round(percentage[i] * 100);
		}
		
		return percent;
	}
	//method to count type distribution by gender
	public static int[] countType(surveyor[] info, String s){
		//type distribution Vs. gender
		int[] type = new int[DIMENSION * 2];
		for(int i = 0; i < info.length; i++){
			if(info[i].gender == s){
				if(info[i].EI == "E"){
					type[0] ++;
				}
				else{
					type[1] ++;
				}
				
				if(info[i].SN == "S"){
					type[2] ++;
				}
				else{
					type[3] ++;
				}
				
				if(info[i].TF == "T"){
					type[4] ++;
				}
				else{
					type[5] ++;
				}
				if(info[i].JP == "J"){
					type[6] ++;
				}
				else{
					type[7] ++;
				}
			}
		}
		return type;
	}
	
	//method to generate result file
	public static void generateResult() throws FileNotFoundException{
		//read and analyze data file
		File surveyFile = new File("bigdata.txt");
		Scanner survey = new Scanner(surveyFile);
		
		PrintStream output = new PrintStream(new File("result.txt")); //output file
		int counter_line = 0; // a counter to record current line number
		
		//get type information of each people
		while(survey.hasNextLine()){
			String line = survey.nextLine();
			counter_line ++;
			
			//start from person name line
			if(counter_line%2 == 0){
//				output.print(line + " "); //no need to keep name
//				line = survey.nextLine();
//				counter_line ++;
				//count A and B by dimension
				//Extrovert/Introvert
				int[] counter_EI = count(line, 0);
				//Sensing/iNtuition
				int[] counter_SN = combine(line, 1, 2);
				//Thinking/Feeling
				int[] counter_TF = combine(line, 3, 4);
				//Judging/Perceiving
				int[] counter_JP = combine(line, 5, 6);
		
				//generate output combination and result
				String  result_dimension = output(counter_EI, counter_SN, counter_TF, counter_JP);	
				//output personality type
				output.print(result_dimension);
				//output other information(gender, section, color, etc.)
				output.println(line.substring(SURVEYS));
			}
		}
	}
	
	//method to count A and B in one dimension
	public static int[] count(String line, int start){
		int num_A = 0;
		int num_B = 0;
		
		for(int i = start; i <= SURVEYS + start - 7; i += 7){
			if(line.toLowerCase().charAt(i) == 'a'){
				num_A ++;
			}
			else if(line.toLowerCase().charAt(i) == 'b'){
				num_B ++;
			}
		}
		
		return new int[] {num_A, num_B};
	}
	
	//method to combine counters in S/N, T/F, J/P dimension
	public static int[] combine(String line, int i, int j){
		int[] counter1 = count(line, i);
		int[] counter2 = count(line, j);
		int[] counter = {counter1[0] + counter2[0], counter1[1] + counter2[1]};
		
		return counter;
	}
	
	//method to calculate B percentage
	public static int calPercentage(int[] counter){
		float percentage = ((float)counter[1])/(counter[0] + counter[1]);
		int percent = (int) Math.round(percentage * 100);
//		System.out.println(percent);
		return percent;
	}
	
	//method to generate type as output, like ISTJ
	public static String output(int[] counter_EI, int[] counter_SN, int[] counter_TF, int[] counter_JP){
		int[] percentage = new int[DIMENSION]; // array to store percentages of 4 dimensions  
		percentage[0] = calPercentage(counter_EI);
		percentage[1] = calPercentage(counter_SN);		
		percentage[2] = calPercentage(counter_TF);		
		percentage[3] = calPercentage(counter_JP);
		
		String result_dimension = "";//string to store result
		
		result_dimension += convert(percentage[0], "EI");
		result_dimension += convert(percentage[1], "SN");
		result_dimension += convert(percentage[2], "TF");
		result_dimension += convert(percentage[3], "JP");		
	
		return result_dimension;
	}
	
	//method to convert from percentage to category
	public static String convert(int percentage, String s){
		String result = "";
		if(percentage > 50){
			result = s.substring(1,2);
		}
		else if(percentage < 50){
			result = s.substring(0,1);
		}
		else{
			result = "X";
		}
		return result;
	}
	//method to output to file
	//type distribution by gender
	public static void output_gender(PrintStream output, int[] percent_F, int[] percent_M){
		output.println("**********************************************************");
		output.println("Personality Type Distribution By Gender");
		output.println("**********************************************************");
		output.println("For female: ");
		output.println("Extrovert: " + percent_F[0] + "%");
		output.println("Introvert: " + percent_F[1] + "%");
		output.println("Sensing: " + percent_F[2] + "%");
		output.println("iNtuition: " + percent_F[3] + "%");
		output.println("Thinking: " + percent_F[4] + "%");
		output.println("Feeling: " + percent_F[5] + "%");
		output.println("Judging: " + percent_F[6] + "%");
		output.println("Perceiving: " + percent_F[7] + "%");
		output.println();
		output.println("For male: ");
		output.println("Extrovert: " + percent_M[0] + "%");
		output.println("Introvert: " + percent_M[1] + "%");
		output.println("Sensing: " + percent_M[2] + "%");
		output.println("iNtuition: " + percent_M[3] + "%");
		output.println("Thinking: " + percent_M[4] + "%");
		output.println("Feeling: " + percent_M[5] + "%");
		output.println("Judging: " + percent_M[6] + "%");
		output.println("Perceiving: " + percent_M[7] + "%");
		
	}

}
